<?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product">

	<select id="total" resultType="float">
		select count(*) from PRODUCT
	</select>

	<!-- List -->
	<select id="list" resultType="Product">
		select * from PRODUCT
		LIMIT
		#{offset}, #{perPage}
	</select>

	<select id="item" resultType="Product">
		SELECT p.*,
		IFNULL(b.BOOKMARK_ID,'N') 'bookmark' FROM (select * from PRODUCT
		where PRODUCT_ID
		= #{productId}) p
		left JOIN bookmark b ON p.PRODUCT_ID = b.PRODUCT_ID
	</select>

	<!-- 생성 -->
	<insert id="add">
		insert into PRODUCT
		values(
		#{productId},
		#{productName},
		#{productSize},
		#{productImage},
		#{certId},
		#{productCertId},
		#{productStartDate},
		#{productEndDate},
		#{companyId},
		#{g2bId},
		#{elId}
		);
	</insert>

	<!-- 수정 -->
	<update id="update">
		update CERT
		set
		CERT_NAME = #{certName},
		CERT_IMAGE =
		#{certImage},
		CERT_INFO = #{certInfo}
		where
		CERT_ID = #{certId}
	</update>

	<!-- 삭제 -->
	<delete id="delete">
		delete from PRODUCT
		where PRODUCT_ID = #{productId}
	</delete>

	<select id="list_mid" resultType="Product">
		select * from PRODUCT p
		where
		p.EL_ID in
		(select b.BOT_CLASS_ID from BOT_CLASS b
		where b.MID_CLASS_ID
		= #{midClassId})
	</select>

	<select id="list_search" resultType="Product">
		select * from PRODUCT
		where PRODUCT_NAME like #{search}
	</select>



	<!--대량 처리 -->
	<select id="list_pager" resultType="Product">
		select P.* , C.COMPANY_NAME from (select * from PRODUCT 
		LIMIT
		#{offset}, #{perPage}) P
		JOIN COMPANY C on P.COMPANY_ID = C.COMPANY_ID
	</select>

	<update id="update_list">
		Insert into PRODUCT
		values
		<foreach collection="list" item="item" separator=",">
			(#{item.productId},
			#{item.productName},
			#{item.productSize},
			#{item.productImage},
			#{item.certId},
			#{item.productCertId},
			#{item.productStartDate},
			#{item.productEndDate},
			#{item.companyId},
			#{item.g2bId},
			#{item.elId})
		</foreach>
		on duplicate key update
		PRODUCT_ID = VALUES(PRODUCT_ID),
		PRODUCT_NAME =
		VALUES(PRODUCT_NAME),
		PRODUCT_SIZE = VALUES(PRODUCT_SIZE),
		PRODUCT_IMAGE = VALUES(PRODUCT_IMAGE),
		CERT_ID = VALUES(CERT_ID),
		PRODUCT_CERT_ID = VALUES(PRODUCT_CERT_ID),
		PRODUCT_START_DATE =
		VALUES(PRODUCT_START_DATE),
		PRODUCT_END_DATE =
		VALUES(PRODUCT_END_DATE),
		COMPANY_ID = VALUES(COMPANY_ID),
		G2B_ID =
		VALUES(G2B_ID),
		EL_ID = VALUES(EL_ID)
	</update>
	
	<update id="api_insert_list">
		Insert ignore into PRODUCT
		values
		<foreach collection="list" item="item" separator=",">
			(#{item.productId},
			#{item.productName},
			#{item.productSize},
			#{item.productImage},
			#{item.certId},
			#{item.productCertId},
			#{item.productStartDate},
			#{item.productEndDate},
			#{item.companyId},
			#{item.g2bId},
			0)
		</foreach>
				
	</update>
	

	<insert id="insert_list">
		INSERT INTO PRODUCT
		VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.productId},
			#{item.productName},
			#{item.productSize},
			#{item.productImage},
			#{item.certId},
			#{item.productCertId},
			#{item.productStartDate},
			#{item.productEndDate},
			#{item.companyId},
			#{item.g2bId},
			0)
		</foreach>
	</insert>

	<delete id="delete_list">
		DELETE FROM PRODUCT
		WHERE PRODUCT_ID in (
		<foreach collection="list" item="item" separator=",">
			#{item.productId}
		</foreach>
		)
	</delete>

	<select id="combo" resultType="ComboItem">
		SELECT "0" AS "table",
		CERT_ID AS
		"id", CERT_NAME AS "text"
		from CERT
		UNION
		SELECT "1" AS "table",
		BOT_CLASS_ID AS "id", BOT_CLASS_NAME AS "text"
		from BOT_CLASS

	</select>
</mapper>